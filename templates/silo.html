<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Silo {{ silo.numero_qr }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:#eef5ee;
  margin:0
}
header{
  background:#2e7d32;
  color:white;
  padding:14px;
  font-size:20px;
  text-align:center
}
.container{
  width:92%;
  margin:20px auto;
  background:white;
  padding:20px;
  border-radius:12px
}
button{
  background:#43a047;
  color:white;
  border:none;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer
}
button:hover{background:#2e7d32}

.info{
  background:#f1f8e9;
  padding:12px;
  border-radius:10px;
  margin-bottom:15px;
  font-size:14px
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:14px
}
th,td{
  border-bottom:1px solid #ddd;
  padding:8px;
  text-align:center
}
th{background:#c8e6c9}

.badge{
  padding:4px 8px;
  border-radius:6px;
  font-weight:bold;
  font-size:12px
}
.verde{background:#c8e6c9;color:#1b5e20}
.amarillo{background:#fff9c4;color:#f57f17}
.rojo{background:#ffcdd2;color:#b71c1c}
</style>
</head>

<body>

<header>SILO ¬∑ {{ silo.numero_qr }}</header>

<div class="container">

<button onclick="location.href='/panel'">‚¨Ö Volver al panel</button>

<div class="info">
  <b>Cereal:</b> {{ silo.cereal }} |
  <b>Estado:</b> {{ silo.estado }} |
  <b>Metros:</b> {{ silo.metros }} <br><br>
  <b>Fecha confecci√≥n:</b>
  {{ silo.fecha_confeccion }}
  ({{ silo.dias_confeccion }} d√≠as)
</div>

<hr>

<h3>Muestreos</h3>

{% if not muestreos %}
  <div class="info">
    ‚ö†Ô∏è Este silo a√∫n no tiene muestreos cargados.
  </div>
{% endif %}

<button onclick="nuevoMuestreo()">‚ûï Nuevo muestreo</button>

<table>
<thead>
<tr>
  <th>Fecha muestreo</th>
  <th>D√≠as desde muestreo</th>
  <th>Estado</th>
  <th>Acci√≥n</th>
</tr>
</thead>

<tbody>
{% for m in muestreos %}
<tr>
  <td>{{ m.fecha_muestreo }}</td>

  <td>
    {% if m.dias_desde_muestreo <= 7 %}
      <span class="badge verde">{{ m.dias_desde_muestreo }} d√≠as</span>
    {% elif m.dias_desde_muestreo <= 20 %}
      <span class="badge amarillo">{{ m.dias_desde_muestreo }} d√≠as</span>
    {% else %}
      <span class="badge rojo">{{ m.dias_desde_muestreo }} d√≠as</span>
    {% endif %}
  </td>

  <td>
    {% if m.dias_desde_muestreo <= 7 %}
      üü¢ Reciente
    {% elif m.dias_desde_muestreo <= 20 %}
      üü° Remuestrear
    {% else %}
      üî¥ Vencido
    {% endif %}
  </td>

  <td>
    <button onclick="location.href='/muestreo/{{ m.id }}'">
      üìä Ver / Cargar an√°lisis
    </button>
  </td>
</tr>
{% endfor %}
</tbody>
</table>

</div>

<script>
function nuevoMuestreo(){
  fetch("/api/nuevo_muestreo",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ qr:"{{ silo.numero_qr }}" })
  }).then(()=>location.reload());
}
</script>

</body>
</html>
