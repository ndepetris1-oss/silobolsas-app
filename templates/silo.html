<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Silo {{ silo.numero_qr }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#eef7ef;margin:0}
header{background:#2e7d32;color:white;text-align:center;padding:14px;font-size:20px}
.container{width:95%;margin:15px auto;background:white;border-radius:14px;padding:15px}
.info{background:#e0e0e0;border-radius:10px;padding:10px;margin-bottom:15px}
button{
  background:#43a047;color:white;border:none;border-radius:8px;
  padding:8px 14px;cursor:pointer
}
button:hover{background:#2e7d32}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #c8e6c9;text-align:center}
th{background:#a5d6a7}
</style>
</head>

<body>

<header>SILO Â· {{ silo.numero_qr }}</header>

<div class="container">

<button onclick="location.href='/panel'">â¬… Volver al panel</button>

<div class="info">
<b>Cereal:</b> {{ silo.cereal }} |
<b>Estado grano:</b> {{ silo.estado }} |
<b>Metros:</b> {{ silo.metros }} |
<b>Fecha confecciÃ³n:</b> {{ silo.fecha_confeccion }}
</div>

<h3>Muestreos</h3>

<button onclick="nuevoMuestreo()">âž• Nuevo muestreo</button>

<table>
<thead>
<tr>
  <th>Fecha muestreo</th>
  <th>DÃ­as desde muestreo</th>
  <th>AcciÃ³n</th>
</tr>
</thead>
<tbody>
{% for m in muestreos %}
<tr>
  <td>{{ m.fecha_muestreo }}</td>
  <td>
    {% if m.dias_desde is not none %}
      {{ m.dias_desde }}
    {% else %}
      -
    {% endif %}
  </td>
  <td>
    <!-- ðŸ‘‡ RUTA CORRECTA -->
    <button onclick="location.href='/muestreo/{{ m.id }}'">ðŸ“Š Ver anÃ¡lisis</button>
  </td>
</tr>
{% endfor %}
</tbody>
</table>

</div>

<script>
async function nuevoMuestreo(){
  const r = await fetch("/api/nuevo_muestreo",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ qr: "{{ silo.numero_qr }}" })
  });
  const d = await r.json();
  if(d.id_muestreo){
    location.href = "/muestreo/" + d.id_muestreo;
  }
}
</script>

</body>
</html>
