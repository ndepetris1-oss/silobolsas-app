<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comparador comercial â€“ {{ cereal }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial, sans-serif;
  background:#eef5f1;
  margin:0;
}
header{
  background:#2e7d32;
  color:white;
  padding:14px;
  text-align:center;
  font-size:20px;
}
.container{
  width:95%;
  margin:15px auto;
  background:white;
  border-radius:14px;
  padding:15px;
}
select, button, input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #81c784;
  font-size:15px;
}
button{
  background:#43a047;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
button:hover{background:#2e7d32}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #c8e6c9;
  text-align:center;
}
th{background:#a5d6a7}
.card{
  background:#f1f8f4;
  padding:12px;
  border-radius:10px;
  margin-top:12px;
}
.bad{color:#b71c1c;font-weight:bold}
.good{color:#2e7d32;font-weight:bold}
</style>
</head>

<body>

<header>ğŸ’° Comparador comercial â€“ {{ cereal }}</header>

<div class="container">

<button onclick="location.href='/comercial'">â† Volver</button>

<div class="card">
  <h3>ğŸŒ¾ Seleccionar silo</h3>
  <select id="siloSelect">
    <option value="">Seleccione un siloâ€¦</option>
    {% for s in silos %}
      <option value="{{ s.numero_qr }}">
        {{ s.numero_qr }} â€” Factor prom: {{ s.factor_prom or "-" }}
      </option>
    {% endfor %}
  </select>
</div>

<div class="card">
  <h3>ğŸ¢ Oferentes</h3>
  <button onclick="abrirGastos(this)">
  âš™ï¸ Gastos
</button>

  <table>
    <tr>
      <th>Oferente</th>
      <th>Precio pizarra</th>
      <th>Gastos</th>
      <th>Precio neto</th>
      <th>Dif. vs mejor</th>
    </tr>

    {% for i in range(4) %}
    <tr>
      <td>
        <input placeholder="Ej: ACA, Cargill">
      </td>
      <td>
        <input type="number" placeholder="ARS/TN">
      </td>
      <td>
        <input type="number" placeholder="Gastos">
      </td>
      <td>-</td>
      <td>-</td>
    </tr>
    {% endfor %}
  </table>

  <button style="margin-top:12px" disabled>
    ğŸ§® Calcular comparaciÃ³n
  </button>
</div>

</div>

</body>
</html>
<!-- MODAL GASTOS -->
<div id="modalGastos" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.5);z-index:999">

  <div style="
    background:white;
    width:90%;
    max-width:500px;
    margin:60px auto;
    padding:20px;
    border-radius:12px
  ">

    <h3>âš™ï¸ Gastos del oferente</h3>

    <label>ğŸšš Flete (ARS/TN)</label>
    <input type="number" id="g_flete">

    <label>â†©ï¸ Contra flete (ARS/TN)</label>
    <input type="number" id="g_contra">

    <label>ğŸ”¥ Secada (ARS/TN)</label>
    <input type="number" id="g_secada">

    <label>ğŸ§ª Fumigada (ARS/TN)</label>
    <input type="number" id="g_fumigada">

    <label>ğŸŒ€ Zarandeo (ARS/TN)</label>
    <input type="number" id="g_zarandeo">

    <hr>

    <label>
      <input type="checkbox" id="bonif_secada">
      No cobrar secada hasta +2% humedad
    </label><br>

    <label>
      <input type="checkbox" id="bonif_fumigada">
      Bonificar fumigada
    </label>

    <hr>

    <button onclick="cerrarGastos()">Cancelar</button>
    <button onclick="aplicarGastos()" style="background:#2e7d32;color:white">
      Aplicar gastos
    </button>

  </div>
</div>
<script>
let filaOferenteActual = null;

function abrirGastos(btn){
  filaOferenteActual = btn.closest("tr");
  document.getElementById("modalGastos").style.display = "block";
}

function cerrarGastos(){
  document.getElementById("modalGastos").style.display = "none";
}

function aplicarGastos(){
  const flete = +g_flete.value || 0;
  const contra = +g_contra.value || 0;
  let secada = +g_secada.value || 0;
  let fumigada = +g_fumigada.value || 0;
  const zarandeo = +g_zarandeo.value || 0;

  if(bonif_fumigada.checked){
    fumigada = 0;
  }

  const totalGastos = flete + contra + secada + fumigada + zarandeo;

  // ğŸ‘‰ acÃ¡ solo mostramos, despuÃ©s calculamos precio neto
  alert("Total gastos: " + totalGastos + " ARS/TN");

  cerrarGastos();
}
</script>
