<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Muestreo - {{ muestreo.numero_qr }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#eef5ee;margin:0}
header{background:#2e7d32;color:white;padding:14px;font-size:20px;text-align:center}
.container{width:90%;margin:20px auto;background:white;padding:20px;border-radius:12px}
.section{border:1px solid #c8e6c9;border-radius:10px;padding:15px;margin-bottom:15px}
button{background:#43a047;color:white;border:none;border-radius:8px;padding:8px 14px;cursor:pointer}
button:hover{background:#2e7d32}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);align-items:center;justify-content:center}
.modal-content{background:white;padding:20px;border-radius:12px;width:400px}
input,select{width:100%;padding:6px;margin-bottom:8px}
</style>
</head>

<body>

<header>Muestreo Â· {{ muestreo.numero_qr }} Â· {{ muestreo.cereal }}</header>

<div class="container">

<button onclick="location.href='/silo/{{ muestreo.numero_qr }}'">â¬… Volver</button>

<p><b>Fecha muestreo:</b> {{ muestreo.fecha_muestreo }}</p>

<h3>Secciones del muestreo</h3>

{% for s in ['punta','medio','final'] %}
<div class="section">
<b>{{ s.capitalize() }}</b><br><br>
<button onclick="abrir('{{ s }}')">âž• Cargar anÃ¡lisis</button>
</div>
{% endfor %}

</div>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">
<h3 id="titulo"></h3>

<input id="temperatura" placeholder="Temperatura">
<input id="humedad" placeholder="Humedad">
<input id="ph" placeholder="PH">
<input id="danados" placeholder="DaÃ±ados">
<input id="quebrados" placeholder="Quebrados">
<input id="materia_extrana" placeholder="Materia extraÃ±a">

<label>Olor (%)</label>
<select id="olor">
<option>0</option><option>0.5</option><option>1</option><option>1.5</option><option>2</option>
</select>

<label>Moho (%)</label>
<select id="moho">
<option>0</option><option>0.5</option><option>1</option><option>1.5</option><option>2</option>
</select>

<label><input type="checkbox" id="insectos"> Insectos</label><br>
<label><input type="checkbox" id="chamico"> Chamico</label><br><br>

<button onclick="guardar()">ðŸ’¾ Guardar</button>
<button onclick="cerrar()">Cancelar</button>
</div>
</div>

<script>
let seccionActual = null;

function abrir(sec){
  seccionActual = sec;
  document.getElementById("titulo").innerText = "AnÃ¡lisis - " + sec;
  document.getElementById("modal").style.display = "flex";
}

function cerrar(){
  document.getElementById("modal").style.display = "none";
}

function guardar(){
  fetch("/api/analisis_seccion",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      id_muestreo: {{ muestreo.id }},
      cereal: "{{ muestreo.cereal }}",
      seccion: seccionActual,
      temperatura: temperatura.value,
      humedad: humedad.value,
      ph: ph.value,
      danados: danados.value,
      quebrados: quebrados.value,
      materia_extrana: materia_extrana.value,
      olor: olor.value,
      moho: moho.value,
      insectos: insectos.checked,
      chamico: chamico.checked
    })
  }).then(()=>{
    location.reload();
  });
}
</script>
<!-- MODAL ANALISIS -->
<div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6);">
  <div style="background:#fff; width:420px; margin:40px auto; padding:20px; border-radius:10px">
    <h3 id="titulo"></h3>

    <input id="temperatura" placeholder="Temperatura">
    <input id="humedad" placeholder="Humedad">
    <input id="ph" placeholder="PH">
    <input id="danados" placeholder="DaÃ±ados">
    <input id="quebrados" placeholder="Quebrados">
    <input id="materia_extrana" placeholder="Materia extraÃ±a">

    <label>Olor (%)</label>
    <select id="olor">
      <option value="0">0</option>
      <option value="0.5">0.5</option>
      <option value="1">1</option>
      <option value="1.5">1.5</option>
      <option value="2">2</option>
    </select>

    <label>Moho (%)</label>
    <select id="moho">
      <option value="0">0</option>
      <option value="0.5">0.5</option>
      <option value="1">1</option>
      <option value="1.5">1.5</option>
      <option value="2">2</option>
    </select>

    <label><input type="checkbox" id="insectos"> Insectos</label><br>
    <label><input type="checkbox" id="chamico"> Chamico</label><br><br>

    <button onclick="guardarAnalisis()">ðŸ’¾ Guardar</button>
    <button onclick="cerrar()">Cancelar</button>
  </div>
</div>

</body>
</html>
