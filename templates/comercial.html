<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comercial</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:#eef5ee;
  margin:0
}
header{
  background:#2e7d32;
  color:white;
  padding:14px;
  font-size:20px;
  text-align:center
}
.container{
  width:95%;
  margin:15px auto;
  background:white;
  padding:15px;
  border-radius:12px
}
table{
  width:100%;
  border-collapse:collapse
}
th,td{
  border:1px solid #c8e6c9;
  padding:8px;
  text-align:center;
  font-size:14px
}
th{background:#e8f5e9}
input{
  width:100%;
  padding:5px
}
button{
  background:#43a047;
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer
}
button:hover{background:#2e7d32}
.small{
  font-size:12px;
  color:#555
}
</style>
</head>

<body>

<header>ğŸ’° Comercial â€“ Precios de mercado</header>

<div class="container">

<table>
<tr>
  <th>Cereal</th>
  <th>Pizarra auto</th>
  <th>Usar manual</th>
  <th>Pizarra manual</th>
  <th>ObservaciÃ³n</th>
  <th>DÃ³lar</th>
  <th>Comparar</th>
  <th></th>
</tr>

{% for m in mercado %}
<tr>
  <td><b>{{ m.cereal }}</b></td>

  <td>
    {{ m.pizarra_auto if m.pizarra_auto else "-" }}
  </td>

  <td>
    <input type="checkbox"
           id="usar_{{ m.cereal }}"
           {% if m.usar_manual %}checked{% endif %}>
  </td>

  <td>
  <input type="number" step="0.01"
         id="dolar_{{ m.cereal }}"
         value="{{ m.dolar or '' }}">
</td>

<td>
  <a href="/comercial/{{ m.cereal }}">
    <button style="background:#1976d2">
      ğŸ“Š Comparar
    </button>
  </a>
</td>

<td>
  <button onclick="guardar('{{ m.cereal }}')">ğŸ’¾</button>
</td>
</tr>
{% endfor %}
</table>

<p class="small">
âœ” Si â€œUsar manualâ€ estÃ¡ tildado, el sistema ignora la pizarra automÃ¡tica.
</p>

</div>

<script>
function guardar(cereal){
  fetch("/api/mercado/manual",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      cereal: cereal,
      usar_manual: document.getElementById("usar_"+cereal).checked,
      pizarra_manual: document.getElementById("manual_"+cereal).value,
      obs_precio: document.getElementById("obs_"+cereal).value,
      dolar: document.getElementById("dolar_"+cereal).value
    })
  }).then(r=>r.json())
    .then(()=>alert("Guardado"));
}
</script>

</body>
</html>
