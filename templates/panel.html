<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel de Silobolsas</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f3f4f6; margin: 20px; }
    h1 { color: #1f2937; }
    table { border-collapse: collapse; width: 100%; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background: #e5e7eb; }
    button { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; }
    .delete-btn { background: #ef4444; color: white; }
    .export-btn { background: #2563eb; color: white; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>üìä Panel de Silobolsas</h1>

  <button class="export-btn" onclick="window.location.href='/exportar_excel'">‚¨áÔ∏è Exportar a Excel</button>

  <table>
    <tr>
      <th>N¬∞ QR</th>
      <th>Cereal</th>
      <th>Metros</th>
      <th>Latitud</th>
      <th>Longitud</th>
      <th>Fecha</th>
      <th>Acci√≥n</th>
    </tr>
    {% for s in silos %}
    <tr id="row-{{ s[0] }}">
      <td>{{ s[0] }}</td>
      <td>{{ s[1] }}</td>
      <td>{{ s[2] }}</td>
      <td>{{ s[3] }}</td>
      <td>{{ s[4] }}</td>
      <td>{{ s[5] }}</td>
      <td><button class="delete-btn" onclick="eliminar('{{ s[0] }}')">üóëÔ∏è Eliminar</button></td>
    </tr>
    {% endfor %}
  </table>

  <script>
    async function eliminar(numero_qr) {
      if (!confirm(`¬øSeguro que quer√©s eliminar el silo ${numero_qr}?`)) return;
      const res = await fetch("/api/delete", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ numero_qr })
      });
      const data = await res.json();
      if (data.status === "deleted") {
        document.getElementById(`row-${numero_qr}`).remove();
        alert(`‚úÖ Silo ${numero_qr} eliminado`);
      }
    }

    // üîÑ Actualiza el panel autom√°ticamente cada 30 segundos
    setInterval(() => location.reload(), 30000);
  </script>
</body>
</html>
